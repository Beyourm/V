    // ------------------------------------------------------------------
    // ุชุนุฑูู ุฃูุณุงู ุงููููุฐุฌ (ุจูุงูุงุช ุฎุทูุฉ ุจุฎุทูุฉ)
    // ------------------------------------------------------------------

    const formSteps = [
        { 
            title: 'ุงููุนูููุงุช ุงูุดุฎุตูุฉ',
            icon: '๐ค',
            content: `
                <div class="form-group">
                    <label for="full_name">ุงูุงุณู ุงููุงูู</label>
                    <input type="text" id="full_name" name="full_name" required>
                </div>
                <div class="form-group">
                    <label for="age">ุงูุนูุฑ</label>
                    <input type="number" id="age" name="age" min="18" max="99" required>
                </div>
                <div class="form-group">
                    <label for="gender">ุงูุฌูุณ</label>
                    <select id="gender" name="gender" required>
                        <option value="">ุงุฎุชุฑ...</option>
                        <option value="male">ุฐูุฑ</option>
                        <option value="female">ุฃูุซู</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="country_city">ุงูุจูุฏ / ุงููุฏููุฉ</label>
                    <input type="text" id="country_city" name="country_city" required>
                </div>
            `
        },
        { 
            title: 'ุงููุคููุงุช ูุงูุฎุจุฑุงุช',
            icon: '๐',
            content: `
                <div class="form-group">
                    <label for="qualification">ุงููุคูู ุงูุนููู</label>
                    <input type="text" id="qualification" name="qualification" required>
                </div>
                <div class="form-group">
                    <label for="specialization">ุงูุชุฎุตุต ุงูุฏุฑุงุณู</label>
                    <input type="text" id="specialization" name="specialization" required>
                </div>
                <div class="form-group">
                    <label for="experience">ุงูุฎุจุฑุงุช ุงูุนูููุฉ</label>
                    <textarea id="experience" name="experience" placeholder="ุงุฐูุฑ ุฃูุงูู ุงูุนูู ุงูุณุงุจูุฉ ูุงูููุงู ุงูุชู ููุช ุจูุง"></textarea>
                </div>
                <div class="form-group">
                    <label for="skills">ุงูููุงุฑุงุช</label>
                    <textarea id="skills" name="skills" placeholder="ูุซุงู: ุงูุญุงุณูุจุ ุงููุบุงุชุ ุงูุชุฏุฑูุจุ ุงูููุงุฑุงุช ุงููููุฉ..."></textarea>
                </div>
                <div class="form-group">
                    <label for="courses">ุงูุฏูุฑุงุช ุงูุชุฏุฑูุจูุฉ ุงูุญุงุตู ุนูููุง</label>
                    <textarea id="courses" name="courses" placeholder="ุงุฐูุฑ ุฃุณูุงุก ุงูุฏูุฑุงุช ูุงููุคุณุณุงุช ุงูุชู ุญุตูุช ุนูููุง ูููุง"></textarea>
                </div>
            `
        },
        { 
            title: 'ูุนูููุงุช ุงูุงุชุตุงู ูุงูููู ุงููุฑูู',
            icon: '๐',
            content: `
                <div class="form-group">
                    <label for="phone">ุฑูู ุงููุงุชู + ูุงุชุณุงุจ</label>
                    <input type="tel" id="phone" name="phone" required>
                </div>
                <div class="form-group">
                    <label for="email">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="telegram">ุฑุงุจุท ุงูุญุณุงุจ ุนูู ุชูููุฌุฑุงู</label>
                    <input type="url" id="telegram" name="telegram" placeholder="ูุซุงู: https://t.me/username">
                </div>
                <div class="form-group">
                    <label for="desired_field">ุงููุฌุงู ุงูุฐู ูุฑุบุจ ุจุงูุนูู ููู</label>
                    <select id="desired_field" name="desired_field" required>
                        <option value="">ุงุฎุชุฑ...</option>
                        <option value="administration">ุฅุฏุงุฑู</option>
                        <option value="trainer">ูุฏุฑุจ</option>
                        <option value="marketing">ุชุณููู</option>
                        <option value="technical_support">ุฏุนู ููู</option>
                        <option value="other">ุฃุฎุฑู</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ (CV)</label>
                    <div class="drag-and-drop-area" id="dropArea">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p><strong>ุงุณุญุจ ูุฃููุช ุงูููู ููุง</strong> ุฃู ุงุถุบุท ููุจุญุซ</p>
                        <input type="file" id="cv" name="cv" class="file-input" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png">
                        <p class="file-info">ุงูุญุฏ ุงูุฃูุตู 5 ููุฌุงุจุงูุช. PDF ุฃู DOCX ููุถู.</p>
                        <p id="fileStatus" class="file-info" style="font-style: normal; font-weight: 700; color: var(--primary-color); margin-top: 5px;">ูู ูุชู ุงุฎุชูุงุฑ ุฃู ููู.</p>
                    </div>
                </div>

                <div class="expectation-message">
                    ููุฏุฑ ููุชู. ุจุนุฏ ุฅุฑุณุงู ุงููููุฐุฌุ ุณูุชู ูุฑุงุฌุนุฉ ุทูุจู ูุณูุชู ุงูุชูุงุตู ูุน ุงููุฑุดุญูู ุงููุคูููู ุฎูุงู **10 ุฃูุงู ุนูู**.
                </div>
            `
        }
    ];

    let currentStep = 0; 
    const form = document.getElementById("jobForm");
    // ูุฐุง ุงูุฑุงุจุท ูุฌุจ ุฃู ูุชู ุชููููู ูููุงุณุจ ุชุทุจูู Google Apps Script ุงูุฎุงุต ุจู
    const scriptURL = "https://script.google.com/macros/s/AKfycbw3_CNHVz2ov0kZLXmZhnz_3MMEzdMsjI7zUotQzlzYGPNPt4EbgQXtkvuGVrvywrfh/exec";


    // ------------------------------------------------------------------
    // ุฏุงูุฉ ุชุญุฏูุซ ุนุฑุถ ุงููุณู ุงููุดุท ูุดุฑูุท ุงูุชูุฏู
    // ------------------------------------------------------------------
    function updateStepDisplay() {
        const stepsDivs = form.querySelectorAll('.form-step');
        const progressSteps = document.querySelectorAll('.progress-container .step');

        stepsDivs.forEach((step, index) => {
            if (index === currentStep) {
                step.classList.add('active');
            } else {
                step.classList.remove('active');
            }
        });

        progressSteps.forEach((step, index) => {
            step.classList.remove('active', 'completed');
            if (index === currentStep) {
                step.classList.add('active');
            } else if (index < currentStep) {
                step.classList.add('completed');
            }
        });
        
        const responseMessage = document.getElementById("response-message");
        if (responseMessage) {
            responseMessage.classList.remove('show');
        }
    }


    // ------------------------------------------------------------------
    // ุฏุงูุฉ ุจูุงุก ุงููููุฐุฌ (ุชูุณุชุฏุนู ูุฑุฉ ูุงุญุฏุฉ ุนูุฏ ุงูุชุญููู)
    // ------------------------------------------------------------------
    function buildFormStructure() {
        formSteps.forEach((step, index) => {
            const stepDiv = document.createElement('div');
            stepDiv.className = 'form-section form-step';
            stepDiv.setAttribute('data-step', index);

            stepDiv.innerHTML = `
                <h2><span class="response-icon">${step.icon}</span> ${step.title}</h2>
                ${step.content}
            `;
            
            // ุฅุถุงูุฉ ุฃุฒุฑุงุฑ ุงูุชููู (ุงูุณุงุจู/ุงูุชุงูู)
            const controlsDiv = document.createElement('div');
            controlsDiv.style.display = 'flex';
            controlsDiv.style.gap = '10px';
            controlsDiv.style.marginTop = '15px';
            
            // ุฒุฑ ุงูุณุงุจู
            if (index > 0) {
                const prevButton = document.createElement('button');
                prevButton.type = 'button';
                prevButton.className = 'btn-action prev-btn';
                prevButton.style.width = index === formSteps.length - 1 ? '50%' : '50%';
                prevButton.textContent = 'ุงูุณุงุจู';
                prevButton.onclick = () => changeStep(index - 1);
                controlsDiv.appendChild(prevButton);
            }
            
            // ุฒุฑ ุงูุชุงูู ุฃู ุงูุฅุฑุณุงู
            if (index < formSteps.length - 1) {
                const nextButton = document.createElement('button');
                nextButton.type = 'button';
                nextButton.className = 'btn-action';
                nextButton.style.width = index === 0 ? '100%' : '50%';
                nextButton.textContent = 'ุงูุชุงูู';
                nextButton.onclick = () => {
                    if (validateCurrentStep()) {
                         changeStep(index + 1);
                    }
                };
                controlsDiv.appendChild(nextButton);
            } else {
                // ุฒุฑ ุงูุฅุฑุณุงู ุงูููุงุฆู
                const submitButton = document.createElement('button');
                submitButton.type = 'submit';
                submitButton.id = 'submitBtn'; 
                submitButton.className = 'btn-submit';
                submitButton.textContent = 'ุฅุฑุณุงู ุงูุทูุจ';
                controlsDiv.appendChild(submitButton);
            }

            stepDiv.appendChild(controlsDiv);
            form.appendChild(stepDiv);
        });

        // ุฅูุดุงุก ูุคุดุฑ ุงูุชุญููู ูุฑุณุงูุฉ ุงูุงุณุชุฌุงุจุฉ ูุฅุถุงูุชููุง ููุฑุฉ ูุงุญุฏุฉ ููุท
        let loadingIndicator = document.createElement('div');
        loadingIndicator.id = 'loading-indicator';
        loadingIndicator.className = 'loading-indicator';
        loadingIndicator.innerHTML = '<span class="icon">โณ</span> ุฌุงุฑู ุฅุฑุณุงู ุงูุทูุจ...';
        form.appendChild(loadingIndicator);
        
        let responseMessage = document.createElement('p');
        responseMessage.id = 'response-message';
        responseMessage.className = 'response-message';
        form.appendChild(responseMessage);

        updateStepDisplay(); // ุงูุชุฃูุฏ ูู ุนุฑุถ ุงููุณู ุงูุฃูู
        setupDragAndDrop(); // ุชูุนูู ููุทูุฉ ุณุญุจ ูุฅููุงุช
    }

    // ุฏุงูุฉ ูุชุบููุฑ ุงููุณู ุงููุดุท
    function changeStep(newStep) {
        currentStep = newStep;
        updateStepDisplay(); 
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ุฏุงูุฉ ุงูุชุญูู ูู ุงูุญููู ุงููุทููุจุฉ ูู ุงููุณู ุงูุญุงูู
    function validateCurrentStep() {
        const currentStepDiv = document.querySelector('.form-step.active');
        const requiredFields = currentStepDiv.querySelectorAll('[required]');
        let isValid = true;

        requiredFields.forEach(field => {
            if (!field.checkValidity()) {
                field.style.border = '2px solid red'; 
                isValid = false;
            } else {
                field.style.border = ''; 
            }
        });

        if (!isValid) {
            alert('ุงูุฑุฌุงุก ุชุนุจุฆุฉ ุฌููุน ุงูุญููู ุงููุทููุจุฉ ุจุดูู ุตุญูุญ ูู ูุฐุง ุงููุณู ูููุชุงุจุนุฉ.');
        }

        return isValid;
    }

    // ------------------------------------------------------------------
    // ููุทู ุณุญุจ ูุฅููุงุช ุงููููุงุช (Drag and Drop Logic)
    // ------------------------------------------------------------------
    function setupDragAndDrop() {
        const dropArea = document.getElementById('dropArea');
        const fileInput = document.getElementById('cv');
        const fileStatus = document.getElementById('fileStatus');

        if (!dropArea || !fileInput) return; 

        dropArea.addEventListener('click', () => fileInput.click());

        fileInput.addEventListener('change', () => {
            if (fileInput.files.length > 0) {
                fileStatus.textContent = `ุชู ุงุฎุชูุงุฑ ุงูููู: ${fileInput.files[0].name}`;
            } else {
                fileStatus.textContent = 'ูู ูุชู ุงุฎุชูุงุฑ ุฃู ููู.';
            }
        });

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
            document.body.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults (e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, () => dropArea.classList.add('drag-over'), false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, () => dropArea.classList.remove('drag-over'), false);
        });

        dropArea.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            
            fileInput.files = files;
            
            const event = new Event('change');
            fileInput.dispatchEvent(event);
        }
    }


    document.addEventListener('DOMContentLoaded', buildFormStructure);

    // ------------------------------------------------------------------
    // ููุทู ุฅุฑุณุงู ุงููููุฐุฌ 
    // ------------------------------------------------------------------

    form.addEventListener("submit", async e => {
      e.preventDefault();
      if (!validateCurrentStep()) return; 

      const submitButton = document.getElementById('submitBtn');
      const loadingIndicator = document.getElementById('loading-indicator');
      const responseMessage = document.getElementById("response-message");
      
      // 1. ุชูุนูู ูุถุน ุงูุชุญููู
      submitButton.style.display = 'none';
      loadingIndicator.classList.add('active');
      responseMessage.classList.remove('show'); 
      
      const formData = new FormData(form);
      const file = formData.get("cv");

      let base64File = "";
      let fileName = "";

      // ูุนุงูุฌุฉ ููู ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ (CV)
      if (file && file.size > 0) {
        fileName = file.name;
        base64File = await toBase64(file);
      }

      const payload = {};
      formData.forEach((value, key) => payload[key] = value);
      payload.cvFile = base64File;
      payload.cvName = fileName;

      try {
        const res = await fetch(scriptURL, {
          method: "POST",
          body: JSON.stringify(payload)
        });

        const response = await res.json();

        // 2. ุฅููุงู ูุถุน ุงูุชุญููู
        loadingIndicator.classList.remove('active');

        if (response.status === "success" || response.status === "ูุฌุงุญ") {
          // ุฑุณุงูุฉ ุงููุฌุงุญ ุงูููุญุณููุฉ
          responseMessage.innerHTML = '<span class="response-icon">โ</span> <strong>ุชูุงูููุง! ุฃูู ุฎุทูุฉ ูุญู ุงูุชููุฒ ูุฏ ุชุญููุช.</strong> ููุฏ ุชู ุงุณุชูุงู ุทูุจู ุจูุฌุงุญุ ููุญู ูุชุญูุณูู ุฌุฏุงู ูุฏุฑุงุณุฉ ูููู.';
          responseMessage.className = "success-message response-message show";
          form.reset();
          currentStep = 0; // ุฅุนุงุฏุฉ ุชุนููู ุงููุคุดุฑ
          updateStepDisplay(); // ุงูุนูุฏุฉ ูููุณู ุงูุฃูู
          // ุชูุธูู ุญุงูุฉ ุงูููู
          document.getElementById('fileStatus').textContent = 'ูู ูุชู ุงุฎุชูุงุฑ ุฃู ููู.';
        } else {
          responseMessage.innerHTML = '<span class="response-icon">โ</span> <strong>ุฎุทุฃ ูู ุงูุฅุฑุณุงู:</strong> ' + (response.message || 'ุญุฏุซ ุฎุทุฃ ุบูุฑ ูุนุฑูู ุฃุซูุงุก ุงูุฅุฑุณุงู.');
          responseMessage.className = "error-message response-message show";
          // ูู ุญุงูุฉ ุงูุฎุทุฃุ ูุนูุฏ ุฅุธูุงุฑ ุฒุฑ ุงูุฅุฑุณุงู
          submitButton.style.display = 'flex'; 
        }
      } catch (error) {
        // 2. ุฅููุงู ูุถุน ุงูุชุญููู ูู ุญุงูุฉ ุงููุดู
        loadingIndicator.classList.remove('active');
        
        responseMessage.innerHTML = '<span class="response-icon">โ</span> <strong>ุฎุทุฃ ูู ุงูุงุชุตุงู:</strong> ุญุฏุซ ุฎุทุฃ ูู ุงูุงุชุตุงูุ ูุฑุฌู ุงููุญุงููุฉ ูุงุญูุงู.';
        responseMessage.className = "error-message response-message show";
        submitButton.style.display = 'flex'; // ุฅุนุงุฏุฉ ุฅุธูุงุฑ ุงูุฒุฑ
        console.error(error);
      }
      
      // ุงูุชูุฑูุฑ ูุฃุณูู ูุฑุคูุฉ ุงูุฑุณุงูุฉ
      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' }); 
    });

    // ุฏุงูุฉ ุชุญููู ุงูููู ุฅูู Base64
    function toBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result.split(",")[1]); 
        reader.onerror = error => reject(error);
      });
    }
