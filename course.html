<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">مؤسسة كن أنت - تفاصيل الدورة</title>
    <meta name="description" content="سجل الآن في دورة الحفظ السريع للقرآن الكريم، تثبيت وحفظ بإتقان.">

    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17515401485"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'AW-17515401485');
    </script>
    <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/course.css"> 
</head>
<body>

<header>
    <h1><i class="fas fa-seedling"></i> مؤسسة كن أنت</h1>
    <nav>
        <a href="index.html">الرئيسية</a>
        <a href="about/index.html">من نحن</a> 
        <a href="courses.html">الدورات</a>
        <a href="contact.html">تواصل معنا</a>
    </nav>
    <span id="status-indicator"></span>
</header>

<div class="hero" data-aos="fade-up">
    <div class="hero-text">
        <h2 id="hero-title">جاري تحميل تفاصيل الدورة...</h2>
        <p id="hero-description"></p>
    </div>
</div>

<div class="marquee"><span id="marquee-text"></span></div>


<div class="container" data-aos="fade-up">
    <div class="video-section" style="margin-top:15px;">
        <div id="video-embed" style="width:100%; height:250px; background-color: #f0f0f0; border-radius:8px; display:flex; justify-content:center; align-items:center;">
             <i class="fa fa-video" style="font-size: 50px; color: #ccc;"></i>
        </div>
    </div>

    <h2>📖 نبذة عن الدورة</h2>
    <p id="course-about"></p>

    <h2>🎯 أهداف الدورة</h2>
    <ul id="objectives-list" data-aos="fade-right"></ul>

    <h2>📌 المحاور الأساسية</h2>
    <ul id="axes-list" data-aos="fade-right"></ul>
  
    <h2>🎓 فريق المدربين</h2>
    <div id="instructors-slider-container" class="slider-container" data-aos="fade-up">
        <div id="instructors-slider" class="instructors-slider"></div>
        <div class="slider-dots instructor-dots"></div>
    </div>

    <h2>💬 آراء المتدربين</h2>
    <div id="testimonials-slider-container" class="slider-container" data-aos="fade-up">
        <div id="testimonials-slider" class="testimonials-slider"></div>
        <div class="slider-dots testimonial-dots"></div>
    </div>

    <h2>❓ الأسئلة الشائعة</h2>
    <div id="faq-container" class="faq-container" data-aos="fade-up">
    </div>

    <h2>🏆 إنجازك بعد الدورة</h2>
    <div class="certificate-section" data-aos="zoom-in">
        <img src="https://i.ibb.co/v4v82S5/certificate-mockup.png" alt="نموذج شهادة الدورة" loading="lazy">
        <ul id="achievements-list" style="margin-top:20px; font-weight:bold; color:var(--primary-color); list-style:none; padding-right:0;"></ul>
    </div>

    <div class="container" id="register-now-section" data-aos="fade-up" style="text-align: center; margin-top: 30px;">
        <h2>💡 لتبدأ رحلة النجاح، انقر هنا للتسجيل!</h2>
        <p>انضم إلينا الآن وانطلق نحو تحقيق أهدافك.</p>
        <a href="form.html" id="register-link" class="btn btn-register" style="margin-top: 20px;">
            اضغط هنا للتسجيل
        </a>
    </div>
  
</div>

<footer>
    <div class="footer-content">
        <div class="footer-links">
            <a href="index.html">الرئيسية</a>
            <a href="about/index.html">من نحن</a>
            <a href="courses.html">الدورات</a>
            <a href="contact.html">تواصل معنا</a>
        </div>
        <div class="footer-social">
            <a href="https://whatsapp.com/channel/0029VaCRNug3bbV13vVHyR0Z" target="_blank" aria-label="WhatsApp Channel"><i class="fab fa-whatsapp"></i></a>
            <a href="https://www.instagram.com/be.youar" target="_blank" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
            <a href="https://www.facebook.com/BeYouTrainin" target="_blank" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
            <a href="https://t.me/beyoue" target="_blank" aria-label="Telegram"><i class="fab fa-telegram-plane"></i></a>
            <a href="https://www.linkedin.com/in/beyouar" target="_blank" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
            <a href="https://www.tiktok.com/@beyoutq" target="_blank" aria-label="TikTok"><i class="fab fa-tiktok"></i></a>
        </div>
        <div class="footer-copy">
            <p>&copy; 2025 مؤسسة كن أنت للتدريب والتأهيل. جميع الحقوق محفوظة.</p>
        </div>
    </div>
</footer>

<a href="#register-now-section" class="btn btn-register sticky-register-btn">سجل الآن</a>
<a href="https://whatsapp.com/channel/0029VaCRNug3bbV13vVHyR0Z" class="sticky-whatsapp-btn" target="_blank" aria-label="تواصل معنا عبر واتساب">
    <i class="fab fa-whatsapp"></i>
</a>
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script src="js/course-slider.js"></script> 
<script src="url.js"></script> 

<script>
    AOS.init();

    const statusIndicator = document.getElementById('status-indicator');
    const urlParams = new URLSearchParams(window.location.search);
    const courseId = urlParams.get('id'); 

    // دالة معالجة الـ FAQ
    function setupFaq(faqsJson) {
        const faqContainer = document.getElementById('faq-container');
        faqContainer.innerHTML = '';
        
        if (!faqsJson) {
            faqContainer.parentElement.style.display = 'none';
            return;
        }

        let faqs;
        try {
            faqs = typeof faqsJson === 'string' ? JSON.parse(faqsJson) : faqsJson;
        } catch (e) {
            faqContainer.parentElement.style.display = 'none';
            return;
        }

        faqs.forEach(f => {
            const div = document.createElement('div');
            div.className = 'faq-item';
            div.innerHTML = `
                <div class="faq-question"><span>${f.question}</span><i class="fa fa-chevron-down"></i></div>
                <div class="faq-answer-content" style="display: none;">${f.answer}</div>`;
            faqContainer.appendChild(div);
        });
        
        // منطق فتح/إغلاق الـ FAQ 
        document.querySelectorAll('.faq-question').forEach(q => {
            q.addEventListener('click', () => {
                const ans = q.nextElementSibling;
                const icon = q.querySelector('i');
                
                // إغلاق جميع الإجابات الأخرى
                document.querySelectorAll('.faq-question').forEach(otherQ => {
                   if (otherQ !== q && otherQ.classList.contains('active')) {
                        otherQ.classList.remove('active');
                        otherQ.nextElementSibling.style.display = 'none';
                        otherQ.querySelector('i').style.transform = 'rotate(0deg)';
                   }
                });

                // فتح أو إغلاق الإجابة الحالية
                q.classList.toggle('active');
                if (q.classList.contains('active')) {
                    ans.style.display = 'block';
                    icon.style.transform = 'rotate(180deg)';
                } else {
                    ans.style.display = 'none';
                    icon.style.transform = 'rotate(0deg)';
                }
            });
        });
    }

    // ✅ دالة واحدة فقط لتحميل بيانات الدورة
    async function loadCourseData() {
        statusIndicator.innerHTML = '🟡';
        
        if (!courseId) {
            statusIndicator.innerHTML = '🔴';
            document.getElementById('hero-title').innerText = "⚠️ يرجى تحديد الدورة";
            document.getElementById('hero-description').innerText = "تم الوصول إلى الصفحة بدون معرف الدورة.";
            document.querySelector('.marquee').style.display = 'none';
            return;
        }

        try {
            // جلب جميع الدورات من الـ API
            const apiUrl = `${API_BASE_URL}?action=courses`; 
            const response = await fetch(apiUrl);
            const allCourses = await response.json();
            
            if (allCourses.status === "error" || !Array.isArray(allCourses)) {
                 throw new Error("فشل في جلب قائمة الدورات من API.");
            }
            
            const course = allCourses.find(c => c.id == courseId); 
            window.course = course;

            if (!window.course || !window.course.title) {
                statusIndicator.innerHTML = '🔴';
                document.getElementById('hero-title').innerText = "⚠️ لم يتم العثور على الدورة المطلوبة";
                document.getElementById('hero-description').innerText = "يرجى التأكد من الرابط أو العودة إلى صفحة الدورات واختيار دورة صحيحة.";
                document.querySelector('.marquee').style.display = 'none';
                return;
            }

            // -----------------  تحديث محتوى الصفحة  -----------------
            document.getElementById('hero-title').innerText = window.course.title || "دورة تدريبية متخصصة";
            document.getElementById('hero-description').innerText = window.course.heroDescription || "";
            document.getElementById('marquee-text').innerText = window.course.marqueeText || "سجل الآن وابدأ رحلتك!";
            document.getElementById('page-title').innerText = `مؤسسة كن أنت - ${window.course.title || "تفاصيل الدورة"}`;
            document.getElementById('course-about').innerText = window.course.courseAbout || "لا توجد نبذة متوفرة حالياً.";

            const videoEmbed = document.getElementById('video-embed');
            if (window.course.videoUrl && window.course.videoUrl.includes('youtube.com')) {
                const embedUrl = window.course.videoUrl.replace('watch?v=', 'embed/').split('&')[0];
                videoEmbed.innerHTML = `<iframe width="100%" height="250" src="${embedUrl}" frameborder="0" allowfullscreen style="border-radius:8px;"></iframe>`;
            } else {
                 videoEmbed.style.display = 'none';
            }
            
            // استدعاء الدوال المساعدة
            window.parseList('objectives-list', window.course.objectives, 'fa fa-check-circle');
            window.parseList('axes-list', window.course.axes, 'fa fa-arrow-alt-circle-left');
            window.parseList('achievements-list', window.course.achievementsText, 'fa fa-star');
            
            window.setupSlider('instructors-slider-container', 'instructor-dots', 'instructors');
            window.setupSlider('testimonials-slider-container', 'testimonial-dots', 'testimonials');
            setupFaq(window.course.faqs);

            // ✅ تحديث رابط التسجيل مع اسم الدورة
            document.getElementById('register-link').href = `form.html?course=${encodeURIComponent(window.course.title)}`;

            // تشغيل السلايدرات
            window.startSliders(); 
            statusIndicator.innerHTML = '🟢';

        } catch (err) {
            console.error('Error fetching course data:', err);
            statusIndicator.innerHTML = '🔴';
            document.getElementById('hero-title').innerText = "⚠️ حدث خطأ أثناء تحميل البيانات";
            document.getElementById('hero-description').innerHTML = "تأكد من اتصالك بالإنترنت ومن أن Apps Script يعمل بشكل صحيح. <br><br> <a href='#' class='btn btn-register' onclick='loadCourseData(); return false;'>إعادة المحاولة</a>";
        }
    }

    document.addEventListener('DOMContentLoaded', loadCourseData);
</script>

</body>
</html>
